Fareoffice Shell
A bunch of sysadmin functions used at Fareoffice.

CLONING
ssh-keygen -t rsa
cat ~/.ssh/id_rsa.pub
# Insert the output into www.github.com.
git clone git@github.com:arlukin/fosh.git

DOCUMENTATION
-------------

THE FLOW OF THE "fosh remote-install"

* Download fosh from git
* On fo-tp-vh01 "fosh remote-install fo-tp-vh01"
** On fo-tp-vh01 "fosh hardening"
** On fo-tp-vh01 "fosh install-kvmhost"
** On fo-tp-vh01 "fosh install-fo-tp-install"
** On fo-tp-vh01 "fosh install-guests"
*** On fo-tp-vh01, install fp-tp-system1
*** On fo-tp-vh01, install fp-tp-gf
** On fo-tp-install "fosh git-clone"
** On fo-tp-install "fosh hardening"
** On fo-tp-install "fosh install-cobbler"
** On fo-tp-install "fosh remote-install"
*** Look for alive hosts defined in install.cfg
*** Run "fosh remote-install xx" on the host alive.
*** Continue until "remote-install" has been executed on all servers. 

TODO
---

This version



* installHttpd 
* installModsecurity
* installFarepayment adapt to installHttpd, installModsecurity

* installGlassfish on all fp-servers.
* installFarepayment on all fp-servers.
* installRentalFront on all fo-servers.
* Rename to syscon.
* Move from github to svn.

* installOpenvpn, has the client openvpn certs a unique common name?
* installOpenvpn, harden openvpn, jailroot, ta.key, Unprivileged mode
  http://openvpn.net/index.php/open-source/documentation/howto.html#security
* Write installLDAP.py script.  
* Write installGlassfish.py script
* Write installMysql.py script
* Write installWeb.py script
* Harden kickstart files according to
  http://kickstart-maker.googlecode.com/svn-history/r20/trunk/kickstart.template
* Add epel repo to fo-tp-install
  repo --name=lepel       --baseurl=http://10.0.0.1:81/yum-repos/epel/i386
* Install fo-tp-mysql on fo-tp-vh03 until vh04 is up again.
* Harden kickstart and hardenscript even more
  http://kickstart-maker.googlecode.com/svn-history/r20/trunk/post/
* Harden according to, or later version.
  http://www.nsa.gov/ia/_files/os/redhat/rhel5-guide-i731.pdf  
* Harden, remove/disable these services
  hplip,isdn,kudzu,xfs,nfs,xinetd,rhnsd,kdump,readahead_later,messagebus,haldaemon,apm  
* Add user used by fosh, so it don't need to use root. Then prevent root ssh login.
  Kickstart command
  user --name=fosh --uid=500 --groups=wheel,root --password=nothingspecial
* Is the ram option in install.cfg working? gf computer hasn't enough memory.  
* Set the linux root email address. The one that are emailed when for example sudo is executed without permission.
* Read http://docs.redhat.com/docs/en-US/Red_Hat_Enterprise_Linux/6/html/Security_Guide/index.html
    
Future version  
* Realtime stdout output from ssh functions.
* fosh remote-install, should loop and wait for all clients to become alive. Then run all commands on them.
* The guests should use the repos on the fo-tp-install.
* The guest should be locally "firewalled" to not be able to reach out to anything
  more then they need. Only repo updates on fo-tp-install.
* Run "remote-install-deamon" on fo-tp-install.
* The remote-install deamon should check for changes in install.cfg.
* Add all output from fosh to a log file.
* Add "fosh remote-install" in kickstart for fo-tp-install
* Check cpu sensors (temp), IPMI??

CHANGELOG
---------
2011-01-29 - Daniel Lindh - Added public and private command types, refactoring of code.
2011-01-28 - Daniel Lindh - Added git-clean command
2011-01-28 - Daniel Lindh - Version 1.0.0 of installFarepayment completed.
2011-01-28 - Daniel Lindh - Version 1.0.0 of PasswordStore completed.

2011-01-27
# installFarepayment
  create database
  deploy ear

2011-01-24
# More secure configuration of NTP. (Still missing optimal iptables)

2011-01-23
# Working draft of installNTP.py

2011-01-21
# Draft of install-mysql
# setup_iptables for installMysql
# Working install-mysql
# Working install-mysql-replication.

2010-12-15
# Install pexpect on all fosh servers.

2010-12-11 -- 2010-12-14
# Write installVpn.py script to install openvpn.

2010-12-10
# Indicate disk space to use for a guest in install.cfg
# Configure install.cfg to use all computers.
# Read "configuration" of which commands to use from the dir bin/fosh/fosh/
  http://stackoverflow.com/questions/1057431/loading-all-modules-in-a-folder-in-python/1057765#1057765

2010-12-09
# Install all servers with pxe.
# Move dhcp to fo-tp-install
