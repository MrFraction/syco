#
# This configuration uses one ip for many domains, and will
# generate warnings in the apache error log that looks like this.
# "[warn] Init: SSL server IP/port conflict:"
# This is not a problem as long as the same SSL-cert can be used for
# all domains.
#
# This should be the first VirtualHosts included by httpd.conf
#

# We can use NameVirtual host for farepayment, beacuse all
# domains/VirtualHosts are using the same wildcard cert.
NameVirtualHost *:80
NameVirtualHost *:443

# False-positive SQL injection.
SecRuleRemoveById 950901
SecRuleRemoveById 981173
SecRuleRemoveById 981248

# Request content type is not allowed by policy.
SecRuleRemoveById 960010

# The application is not available
SecRuleRemoveById 970901
SecRuleRemoveById 973302
SecRuleRemoveById 981242
SecRuleRemoveById 981319

# Outbound Anomaly Score Exceeded (score 4): The application is not available.
SecRuleRemoveById 981205

# SQL Character Anomaly Detection Alert - Repetative Non-Word Characters
SecRuleRemoveById 960024

# SQL Comment Sequence Detected.
SecRuleRemoveById 981231

# Redirect all HTTP requests to HTTPS if no specific
# virtualhost is specified.
<VirtualHost *:80>
  ServerName superadmin.farepayment.com

  DocumentRoot /var/www/html

  #ErrorLog logs/www.farepayment.com-error_log
  ErrorLog syslog:local1
  CustomLog logs/www.farepayment.com-access_log combined

  RewriteEngine on

  RewriteCond %{REQUEST_URI} !^/sec
  RewriteCond %{REQUEST_URI} !^/error
  RewriteRule ^(.*)$ https://%{SERVER_NAME}$1 [R=301,L]
</VirtualHost>

# This virtualhost will redirect all HTTP requests on port 80
# to the php webserver, which holdes the www.farepayment.com
# web page.
<VirtualHost *:80>
  ServerName  www.farepayment.com
  ServerAlias farepayment.com

  DocumentRoot /var/www/html

  #ErrorLog logs/www.farepayment.com-error_log
  ErrorLog syslog:local1
  CustomLog logs/www.farepayment.com-access_log combined

  RewriteEngine on
  RewriteRule ^/superadmin(.*)$ https://superadmin.farepayment.com$1 [R=301,L]
  RewriteRule ^/backoffice(.*)$ https://backoffice.farepayment.com$1 [R=301,L]
  RewriteRule ^/spp(.*)$ https://www.farepayment.com/spp$1 [R=301,L]

  RewriteCond %{REQUEST_URI} !^/sec
  RewriteCond %{REQUEST_URI} !^/error
  RewriteRule ^.*$ http://www.fareoffice.com/farepayment.html [R=301,L]
</VirtualHost>

# Used by old SPP customers.
<VirtualHost *:443>
  ServerName  www.farepayment.com
  ServerAlias farepayment.com

  DocumentRoot /var/www/html

  #ErrorLog logs/www.farepayment.com-error_log
  ErrorLog syslog:local1
  CustomLog logs/www.farepayment.com-access_log combined

  Include conf.d/010-www.farepayment.com.ssl.inc

  RewriteEngine on
  RewriteRule ^/superadmin(.*)$ https://superadmin.farepayment.com$1 [R=301,L]
  RewriteRule ^/backoffice(.*)$ https://backoffice.farepayment.com$1 [R=301,L]
  RewriteRule ^/spp(.*)$ http://127.0.0.1:8080/spp$1 [P]

  RewriteCond %{REQUEST_URI} !^/sec
  RewriteCond %{REQUEST_URI} !^/error
  RewriteRule ^.*$ http://www.fareoffice.com/farepayment.html [R=301,L]

  ProxyPassReverse /spp http://127.0.0.1:8080/spp
  ProxyTimeout 600
</VirtualHost>

#
# Superadmin
#
<VirtualHost *:443>
  ServerName  superadmin.farepayment.com
  ServerAlias superadmin-active-prod-nsg.farepayment.com
  ServerAlias superadmin-active-prod-av.farepayment.com
  ServerAlias superadmin-active-prod-tc.farepayment.com
  ServerAlias superadmin-active-uat-tp.farepayment.com
  ServerAlias superadmin-active-stable-tp.farepayment.com
  ServerAlias superadmin-active-integration-tp.farepayment.com

  Include conf.d/010-www.farepayment.com.ssl.inc

  RewriteEngine on
  RewriteRule ^/superadmin(.*)$ http://127.0.0.1:8080/superadmin$1 [P]
  ProxyPassReverse /superadmin/ http://127.0.0.1:8080/superadmin/
  ProxyTimeout 600

  RewriteCond %{REQUEST_URI} !^/sec
  RewriteCond %{REQUEST_URI} !^/error
  RewriteRule ^(.*)$ https://%{SERVER_NAME}/superadmin$1 [R=301,L]

</VirtualHost>



#
# Backoffice
#
<VirtualHost *:443>
  ServerName  backoffice.farepayment.com
  ServerAlias backoffice-active-prod-nsg.farepayment.com
  ServerAlias backoffice-active-prod-av.farepayment.com
  ServerAlias backoffice-active-prod-tc.farepayment.com
  ServerAlias backoffice-active-uat-tp.farepayment.com
  ServerAlias backoffice-active-stable-tp.farepayment.com
  ServerAlias backoffice-active-integration-tp.farepayment.com

  Include conf.d/010-www.farepayment.com.ssl.inc

  RewriteEngine on
  RewriteRule ^/backoffice(.*)$ http://127.0.0.1:8080/backoffice$1 [P]
  ProxyPassReverse /backoffice/ http://127.0.0.1:8080/backoffice/
  ProxyTimeout 600

  RewriteCond %{REQUEST_URI} !^/sec
  RewriteCond %{REQUEST_URI} !^/error
  RewriteRule ^(.*)$ https://%{SERVER_NAME}/backoffice$1 [R=301,L]
  ProxyTimeout 600
</VirtualHost>



#
# Paymentservice
#
<VirtualHost *:443>
  ServerName  paymentservice.farepayment.com
  ServerAlias paymentservice-active-prod-nsg.farepayment.com
  ServerAlias paymentservice-active-prod-av.farepayment.com
  ServerAlias paymentservice-active-prod-tc.farepayment.com
  ServerAlias paymentservice-active-uat-tp.farepayment.com
  ServerAlias paymentservice-active-stable-tp.farepayment.com
  ServerAlias paymentservice-active-integration-tp.farepayment.com

  Include conf.d/010-www.farepayment.com.ssl.inc

  <Location /*>
    #
    # Client requiered client-cert to connect to this vhost.
    #
    SSLVerifyClient require

    # Depth is a number which specifies how deeply to verify the certificate
    # issuer chain before deciding the certificate is not valid.
    SSLVerifyDepth 1
  </Location>

  ProxyPass / http://127.0.0.1:8080/paymentservice/
  ProxyPassReverse / http://127.0.0.1:8080/paymentservice/
  ProxyTimeout 600
</VirtualHost>

<VirtualHost *:443>
  ServerName  paymentservice-passive-prod-nsg.farepayment.com
  ServerAlias paymentservice-passive-prod-av.farepayment.com
  ServerAlias paymentservice-passive-prod-tc.farepayment.com
  ServerAlias paymentservice-passive-uat-tp.farepayment.com
  ServerAlias paymentservice-passive-stable-tp.farepayment.com
  ServerAlias paymentservice-passive-integration-tp.farepayment.com

  Include conf.d/010-www.farepayment.com.ssl.inc

  <Location /*>
    #
    # Client requiered client-cert to connect to this vhost.
    #
    SSLVerifyClient require

    # Depth is a number which specifies how deeply to verify the certificate
    # issuer chain before deciding the certificate is not valid.
    SSLVerifyDepth 1
  </Location>

  ProxyPass / http://127.0.0.1:8080/paymentservice/
  ProxyPassReverse / http://127.0.0.1:8080/paymentservice/
  ProxyTimeout 600
</VirtualHost>

#
# SPP
#
<VirtualHost *:443>
  ServerName  spp.farepayment.com
  ServerAlias spp-active-prod-nsg.farepayment.com
  ServerAlias spp-active-prod-av.farepayment.com
  ServerAlias spp-active-prod-tc.farepayment.com
  ServerAlias spp-active-uat-tp.farepayment.com
  ServerAlias spp-active-stable-tp.farepayment.com
  ServerAlias spp-active-integration-tp.farepayment.com

  Include conf.d/010-www.farepayment.com.ssl.inc

  RewriteEngine on
  RewriteRule ^/spp(.*)$ http://127.0.0.1:8080/spp$1 [P]
  ProxyPassReverse /spp/ http://127.0.0.1:8080/spp/
  ProxyTimeout 600

  RewriteCond %{REQUEST_URI} !^/sec
  RewriteCond %{REQUEST_URI} !^/error
  RewriteRule ^(.*)$ https://%{SERVER_NAME}/spp$1 [R=301,L]
</VirtualHost>

#
# SPP
#
<VirtualHost *:443>
  ServerName  sps.farepayment.com
  ServerAlias sps-active-prod-nsg.farepayment.com
  ServerAlias sps-active-prod-av.farepayment.com
  ServerAlias sps-active-prod-tc.farepayment.com
  ServerAlias sps-active-uat-tp.farepayment.com
  ServerAlias sps-active-stable-tp.farepayment.com
  ServerAlias sps-active-integration-tp.farepayment.com
  ServerAlias sps-uat.farepayment.com

  Include conf.d/010-www.farepayment.com.ssl.inc

  RewriteEngine on
  RewriteRule ^/sps(.*)$ http://127.0.0.1:8080/sps$1 [P]
  ProxyPassReverse /sps/ http://127.0.0.1:8080/sps/
  ProxyTimeout 600



  RewriteCond %{REQUEST_URI} !^/sec
  RewriteCond %{REQUEST_URI} !^/error
  RewriteRule ^(.*)$ https://%{SERVER_NAME}/sps$1 [R=301,L]
</VirtualHost>


#
# Diagnostics
#
<VirtualHost *:443>
  ServerName  diagnostics.farepayment.com
  ServerAlias diagnostics-active-prod-nsg.farepayment.com
  ServerAlias diagnostics-active-prod-av.farepayment.com
  ServerAlias diagnostics-active-prod-tc.farepayment.com
  ServerAlias diagnostics-active-uat-tp.farepayment.com
  ServerAlias diagnostics-active-stable-tp.farepayment.com
  ServerAlias diagnostics-active-integration-tp.farepayment.com

  Include conf.d/010-www.farepayment.com.ssl.inc

  ProxyPass / http://127.0.0.1:8080/diagnostics/
  ProxyPassReverse / http://127.0.0.1:8080/diagnostics/
  ProxyTimeout 600
</VirtualHost>


