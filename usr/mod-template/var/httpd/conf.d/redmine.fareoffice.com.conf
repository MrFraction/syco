<VirtualHost *:80>
  ServerName redmine.fareoffice.com
  DocumentRoot /var/www/html

  RewriteEngine On
  RewriteCond %{HTTPS} off
  RewriteRule (.*) https://%{HTTP_HOST}%{REQUEST_URI}
</VirtualHost>

<VirtualHost *:443>
  ServerName redmine.fareoffice.com
	RewriteEngine On

	# Redirect all non-static requests to cluster
	RewriteCond %{DOCUMENT_ROOT}/%{REQUEST_FILENAME} !-f
	RewriteRule ^/(.*)$ balancer://redminecluster%{REQUEST_URI} [P,QSA,L]

	SSLEngine on
	SSLProtocol -all +SSLv3 +TLSv1
	SSLHonorCipherOrder On
	SSLCipherSuite ECDHE-RSA-AES128-SHA256:AES128-GCM-SHA256:RC4:HIGH:!MD5:!aNULL:!EDH
	SSLCertificateFile /etc/pki/tls/certs/fareoffice.com.crt
	SSLCertificateKeyFile /etc/pki/tls/private/fareoffice.com.key

	SecRuleInheritance Off
	LogFormat "%t %h:%{remote}p %u \"%{Host}i\" \"%r\" %>s %b \"%{Referer}i\" \"%{User-Agent}i\" \"%{Authorization}i\"" basiclog
	SetEnvIf Request_URI "^/projects/sysoparenden/issues" log
	
	#ErrorLog logs/redmine.fareoffice.com-error_log
	ErrorLog syslog:local1
	CustomLog logs/redmine.fareoffice.com-access_log combined

	CustomLog logs/arende.redmine.com-acces_log basiclog env=log 
	
  <Location /projects/sysoparenden/issues >
  </Location>
</VirtualHost>

<Proxy balancer://redminecluster>
	BalancerMember http://redmine:8000
	BalancerMember http://redmine:8001
	BalancerMember http://redmine:8002
	BalancerMember http://redmine:8003
	BalancerMember http://redmine:8004
	BalancerMember http://redmine:8005
	BalancerMember http://redmine:8006
	BalancerMember http://redmine:8007
	BalancerMember http://redmine:8008
	BalancerMember http://redmine:8009
</Proxy>
